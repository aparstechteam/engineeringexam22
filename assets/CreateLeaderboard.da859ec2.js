var N=Object.defineProperty,j=Object.defineProperties;var D=Object.getOwnPropertyDescriptors;var y=Object.getOwnPropertySymbols;var L=Object.prototype.hasOwnProperty,R=Object.prototype.propertyIsEnumerable;var w=(c,s,l)=>s in c?N(c,s,{enumerable:!0,configurable:!0,writable:!0,value:l}):c[s]=l,g=(c,s)=>{for(var l in s||(s={}))L.call(s,l)&&w(c,l,s[l]);if(y)for(var l of y(s))R.call(s,l)&&w(c,l,s[l]);return c},b=(c,s)=>j(c,D(s));import{r as v,j as u,k as i,l as e,F as x,x as p,G as A,y as H,I as B,D as T,E as U,z as V,U as I,m as h}from"./index.10290d53.js";import{_ as E}from"./lodash.c3f3f727.js";const z={class:"container mx-auto"},F={class:"print:hidden"},G=e("div",null,[e("h1",{class:"text-lg text-center"}," Select Exams and create leaderboard ")],-1),J={class:"max-w-2xl mx-auto mt-5 overflow-x-auto"},M={class:"table w-full"},O=e("thead",null,[e("tr",null,[e("th",null,"Select"),e("th",null,"Title"),e("th",null,"Total Students")])],-1),P=["onUpdate:modelValue"],Q={class:"flex justify-center gap-3 my-4 text-center"},q=B(),K=e("span",{class:"material-icons"},"upload_file",-1),W=B(" Export "),X=[K,W],Y={key:0},Z={class:"mx-auto mt-5 overflow-x-auto"},$={class:"table w-full"},ee=e("th",{class:"text-center"},"Rank",-1),te=e("th",{class:"text-center"},"ID",-1),se=e("th",{class:"text-center"},"Name",-1),le={class:"text-center"},ae=e("th",{class:"text-center"},"Average Score",-1),oe={class:"text-center"},re={class:"text-center"},ne={class:"text-center"},ce={class:"text-center"},he={setup(c){const s=v([]),l=v([]),f=v([]);(()=>{T.get(U+"?type=examlist").then(_=>{s.value=_.data.routines.map((n,t)=>{let o=[],d="https://script.google.com/macros/s/AKfycbxHZMx1M1oGvp-wPb7mHwQrfkDBpkS3BG0WtciUJ_HHJTswLgJ2Ba4f8XBLNHOkjYEERQ/exec?sheet="+n.exam.substr(39,44);return fetch(d).then(r=>r.json()).then(r=>{o=E.sortBy(r.map(a=>b(g({},a),{attempt:a.attempt||1})),[a=>-a.score,"duration"]).map((a,k)=>b(g({position:1},a),{eid:t,ttrx:a.ttrx?a.ttrx:a.name.split(" ")[0]})),f.value=[...f.value,...o.map(a=>a.ttrx)],s.value[t].results=o,s.value[t].total=o.length}),{select:!0,title:n.topic,results:o}})})})();const m=v(!1),S=()=>{m.value=!0;let _=[...new Set(f.value)];l.value=[],_.forEach(n=>{let t="",o=s.value.filter(r=>r.select).map(r=>{let a=r.results.find(k=>k.ttrx==n);return a?(t=a.name?a.name:a.ttrx,{eid:r.results[0].eid,score:a.score}):{eid:r.results[0].eid,score:0}}),d=o.map(r=>Number(r.score)).reduce((r,a)=>r+a,0);t&&(l.value=[...l.value,{ttrx:n,name:t,score:d,exams:o,average_score:(d/o.length).toFixed(2)}]),l.value=E.sortBy(l.value,[r=>-r.average_score]),m.value=l.value.length!=_.length}),m.value=!1},C=()=>{let _="ID,Name,"+s.value.filter(t=>t.select).map(t=>t.title).join(",")+`,Total Score
`;l.value.forEach(t=>{_+=t.ttrx+","+t.name+","+t.exams.map(o=>o.score).join(",")+","+t.score+`
`});var n=document.createElement("a");n.href="data:text/csv;charset=utf-8,"+encodeURI(_),n.target="_blank",n.download="overall_result.csv",n.click()};return(_,n)=>(u(),i("div",z,[e("div",F,[G,e("div",J,[e("table",M,[O,e("tbody",null,[(u(!0),i(x,null,p(s.value,(t,o)=>(u(),i("tr",{key:o},[e("th",null,[V(e("input",{type:"checkbox",class:"checkbox","onUpdate:modelValue":d=>s.value[o].select=d},null,8,P),[[I,s.value[o].select]])]),e("td",null,h(t.title),1),e("td",null,h(t.total?t.total:"Loading..."),1)]))),128))])])]),e("div",Q,[e("button",{onClick:S,class:A(["capitalize btn",{loading:m.value}])},"Prepare Overall Leaderboard",2),q,e("button",{class:"btn",onClick:C},X)])]),l.value.length>0?(u(),i("div",Y,[e("div",Z,[e("table",$,[e("thead",null,[e("tr",null,[ee,te,se,(u(!0),i(x,null,p(s.value.filter(t=>t.select),t=>(u(),i("th",le,h(t.title),1))),256)),ae])]),e("tbody",null,[(u(!0),i(x,null,p(l.value,(t,o)=>(u(),i("tr",{key:o},[e("td",oe,h(o+1),1),e("td",re,h(t.ttrx),1),e("td",ne,h(t.name),1),(u(!0),i(x,null,p(t.exams,d=>(u(),i("td",{class:"text-center",key:d.eid},h(d.score),1))),128)),e("td",ce,h(t.average_score),1)]))),128))])])])])):H("",!0)]))}};export{he as default};
